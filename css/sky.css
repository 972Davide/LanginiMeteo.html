function updateSky() {
    if (!unlocked) return;

    const now = new Date();
    const times = SunCalc.getTimes(now, LAT, LON);

    const SKY = document.getElementById("sky");
    const SM = document.getElementById("sunMoon");
    const MASK = document.getElementById("moonMask");

    const isDay = now >= times.sunrise && now <= times.sunset;

    /* =====================================================
       DETERMINIAMO QUALE ASTRO MOSTRARE
    ===================================================== */
    if (isDay) {
        SM.className = "sun";
        MASK.style.display = "none";
    } else {
        SM.className = "moon";
        MASK.style.display = "block";
    }

    /* =====================================================
       CALCOLO ORBITA – ANGOLAZIONE REALISTICA
       - Sole al centro a mezzogiorno
       - Luna al centro a mezzanotte
    ===================================================== */

    let start, end;

    if (isDay) {
        start = times.sunrise;
        end   = times.sunset;
    } else {
        // notte → dall’ultimo tramonto alla prossima alba
        const nextSunrise = new Date(times.sunrise.getTime() + 86400000);
        start = times.sunset;
        end   = nextSunrise;
    }

    let p = (now - start) / (end - start);
    p = clamp(p, 0, 1);

    /* =====================================================
       POSIZIONE ORBITALE – MEZZOGIORNO/MIDNIGHT AL CENTRO
       Descrizione:
       - p=0 → orizzonte sinistro
       - p=0.5 → ZENIT (centro schermo)
       - p=1 → orizzonte destro
    ===================================================== */

    const W = window.innerWidth;
    const H = window.innerHeight;

    const orbitWidth = W + 200;   // margine extra per entrare in scena
    const baseY = H * 0.75;       // altezza orizzonte
    const zenithHeight = H * 0.25; // punto più alto

    // Movimento orizzontale lineare
    const x = p * orbitWidth - 100;

    // Curva verticale: sinusoide
    const y = baseY - Math.sin(Math.PI * p) * (baseY - zenithHeight);

    SM.style.left = `${x}px`;
    SM.style.top  = `${y}px`;

    /* =====================================================
       SFUMATURA DEL CIELO
    ===================================================== */
    const pos = SunCalc.getPosition(now, LAT, LON);
    const alt = pos.altitude * 180 / Math.PI;

    const NIGHT = "#000814";
    const DAY = "#1f2b3a";

    let blend = 0;

    if (alt <= -12) blend = 0;
    else if (alt >= 45) blend = 1;
    else blend = (alt + 12) / (45 + 12);

    SKY.style.background = interpolateColor(NIGHT, DAY, blend);

    SKY.classList.toggle("night", !isDay);
    SKY.classList.toggle("day", isDay);
}
