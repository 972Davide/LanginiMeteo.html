/* ====== STELLE IN BASE AD ALBA / TRAMONTO ====== */
function isNightTime() {
  const now = new Date();
  const times = SunCalc.getTimes(now, LAT, LON);
  return now < times.sunrise || now > times.sunset;
}

function toggleStars() {
  if (!unlocked) return;
  document.getElementById("stars").style.opacity = isNightTime() ? 1 : 0;
}

/* ====== METEORE IN BASE AD ALBA / TRAMONTO ====== */
function triggerMeteor(id){
  if (!unlocked || !isNightTime()) return;

  const el=document.getElementById(id);
  const startY = 5 + Math.random()*35;
  const startX = -200 - Math.random()*200;

  el.style.top = startY + "vh";
  el.style.left = startX + "px";
  el.style.opacity = 1;
  el.style.animation = "none";
  void el.offsetWidth;
  el.style.animation = "meteorMove 1.2s linear forwards";
  setTimeout(() => el.style.opacity = 0, 1300);
}

function scheduleMeteors(){
  const delay = 5000 + Math.random()*7000;
  setTimeout(()=>{
    if (isNightTime()) {
      triggerMeteor("meteor1");
      if (Math.random() < 0.4) triggerMeteor("meteor2");
    }
    scheduleMeteors();
  }, delay);
}

/* ====== SHOOTING STAR (solo notte) ====== */
function maybeStar(){
  if (!unlocked || !isNightTime()) return;
  if (Math.random() < 0.20) {
    const s=document.getElementById("shootingStar");
    s.classList.add("active");
    setTimeout(()=>s.classList.remove("active"),1300);
  }
}
