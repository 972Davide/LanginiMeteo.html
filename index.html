<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Langini Meteo ‚Äì Dashboard Unificata</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/raphael@2.3.0/raphael.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/justgage@1.5.0/justgage.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>

<style>
/* ------------------------------ */
/*            STILI               */
/* ------------------------------ */

body{
  margin:0;font-family:"Poppins",sans-serif;color:white;text-align:center;
  overflow-x:hidden;transition:background 2s;
  background:linear-gradient(to bottom,#001b3a 0%,#004a8d 40%,#0066b2 100%);
}
header{
  background:rgba(0,0,30,0.7);
  color:#fff;
  padding:16px 0 10px;
  font-weight:600;
  box-shadow:0 2px 10px rgba(0,0,0,0.25);
  text-align:center;
}
header .mainTitle{
  font-size:1.7em;
  display:inline-block;
  vertical-align:middle;
}
header .subTitle{
  font-size:1.05em;
  font-weight:400;
  color:#a9c9ff;
  margin-left:12px;
  vertical-align:middle;
  opacity:0.9;
}
#statusBar{
  background:rgba(0,0,0,0.15);
  font-size:0.93em;
  color:#a9c9ff;
  padding:6px;
}

/* CIELO ANIMATO */
#sky{
  position:relative;
  height:46vh;
  overflow:hidden;
  border-bottom:4px solid #048;
}
#stars{position:absolute;inset:0;opacity:0;z-index:1;}
.star{
  position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;
  animation:twinkle 4s infinite;
}
@keyframes twinkle{0%,100%{opacity:0.2}50%{opacity:1}}
#sun,#moon{
  position:absolute;top:53%;left:50%;width:110px;height:110px;border-radius:50%;
  transform:translate(-50%,-50%);transition:left 1.5s,top 1.5s,opacity 2s;
  z-index:2;opacity:0;
}
#sun{
  background:radial-gradient(circle,#fff600 20%,#ffcc00 70%,#ffaa00 100%);
  box-shadow:0 0 40px 10px #ffcc00;
}
#moon{
  background:radial-gradient(circle at 31% 32%,#f0f0f0 40%,#bdbdbd 100%);
  box-shadow:0 0 25px 5px #ccc;
}

/* Gauges */
#gauges{
  display:flex;flex-wrap:wrap;justify-content:center;gap:22px;
  padding:20px 0 30px;background:linear-gradient(to bottom,#002850,#00142c);
  border-top:3px solid #004b8d;
}
.gaugeBox{
  background:linear-gradient(to bottom,#f8fbff,#e6edf5);
  border-radius:16px;width:230px;height:235px;padding:8px;
  color:#003366;box-shadow:0 0 10px rgba(0,0,0,0.14);position:relative;
}
.gaugeBox img{position:absolute;top:8px;right:8px;width:34px;opacity:0.84;}
.label{font-size:1.05em;font-weight:600;margin-top:6px;}
.mean{font-size:0.88em;color:#444;margin-top:6px;}

/* Card pioggia */
#rainStatus{
  height:130px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.9em;
  font-weight:700;
}
#rainTime{font-weight:600;}

footer{
  font-size:0.9em;color:#a9c9ff;background:#001b3a;padding:10px;
}

</style>
</head>

<body>

<header>üå§Ô∏è <span class="mainTitle">Langini Meteo ‚Äì Dashboard</span>
<span class="subTitle">Tutti i sensori ‚Äì 2 Canali ThingSpeak</span></header>

<div id="statusBar">Caricamento dati...</div>

<div id="gauges">

  <div class="gaugeBox">
    <img src="https://img.icons8.com/fluency/48/barometer.png">
    <div id="g1" style="height:130px"></div>
    <div class="label">Pressione (hPa)</div>
  </div>

  <div class="gaugeBox">
    <img src="https://img.icons8.com/fluency/48/temperature.png">
    <div id="g2" style="height:130px"></div>
    <div class="label">Temperatura (¬∞C)</div>
  </div>

  <div class="gaugeBox">
    <img src="https://img.icons8.com/fluency/48/hygrometer.png">
    <div id="g3" style="height:130px"></div>
    <div class="label">Umidit√† (%)</div>
  </div>

  <div class="gaugeBox">
    <img src="https://img.icons8.com/fluency/48/smelling.png">
    <div id="g4" style="height:130px"></div>
    <div class="label">Qualit√† Aria (MQ135)</div>
  </div>

  <div class="gaugeBox">
    <img src="https://img.icons8.com/fluency/48/wind.png">
    <div id="g5" style="height:130px"></div>
    <div class="label">Vento (km/h)</div>
  </div>

  <div class="gaugeBox">
    <img src="https://img.icons8.com/fluency/48/rain.png">
    <div id="rainStatus">--</div>
    <div class="label">Pioggia</div>
    <div class="mean">Ultima rilevazione: <span id="rainTime">--</span></div>
  </div>

</div>

<footer>¬© 2025 Langini Meteo ‚Ä¢ Dashboard Unificata</footer>


<script>

/* ===============================
        CANALI THINGSPEAK
   =============================== */

const METEO_CHANNEL = 3149218;   // pressione, temp, umidit√†, qualit√† aria
const WIND_CHANNEL  = 2956240;   // vento + pioggia

/* ===============================
        GAUGES
   =============================== */
const g1 = new JustGage({id:"g1", value:0, min:950, max:1050});
const g2 = new JustGage({id:"g2", value:0, min:-10, max:50});
const g3 = new JustGage({id:"g3", value:0, min:0, max:100});
const g4 = new JustGage({id:"g4", value:0, min:0, max:500});
const g5 = new JustGage({id:"g5", value:0, min:0, max:120});

/* ===============================
        FUNZIONE PRINCIPALE
   =============================== */
async function aggiorna(){

  try{

    // ========================
    //   METEO (PRIMO CANALE)
    // ========================
    const r1 = await fetch(`https://api.thingspeak.com/channels/${METEO_CHANNEL}/feeds.json?results=1`);
    const d1 = await r1.json();
    const f1 = d1.feeds[0];

    let pressione   = parseFloat(f1.field1);
    let temperatura = parseFloat(f1.field2);
    let umidita     = parseFloat(f1.field3);
    let qualitaAria = parseFloat(f1.field4);

    g1.refresh(pressione);
    g2.refresh(temperatura);
    g3.refresh(umidita);
    g4.refresh(qualitaAria);

    // ============================
    //   VENTO / PIOGGIA (SECONDO CANALE)
    // ============================
    const r2 = await fetch(`https://api.thingspeak.com/channels/${WIND_CHANNEL}/feeds.json?results=1`);
    const d2 = await r2.json();
    const f2 = d2.feeds[0];

    let ventoKmh = parseFloat(f2.field1);
    let pioggia  = parseInt(f2.field2);

    g5.refresh(ventoKmh);

    document.getElementById("rainStatus").textContent =
      pioggia === 1 ? "üåßÔ∏è Pioggia" : "‚òÄÔ∏è Asciutto";

    let t = new Date(f2.created_at);
    document.getElementById("rainTime").textContent =
      t.toLocaleTimeString("it-IT");

    // ============================
    //   BARRA DI STATO
    // ============================
    document.getElementById("statusBar").textContent =
      `OK ‚Ä¢ Ultimo aggiornamento: ${t.toLocaleTimeString("it-IT")} ‚Ä¢ Vento: ${ventoKmh} km/h`;

  }catch(e){
    console.log(e);
    document.getElementById("statusBar").textContent =
      "Errore di connessione a ThingSpeak";
  }

}

aggiorna();
setInterval(aggiorna, 20000);

</script>
</body>
</html>
