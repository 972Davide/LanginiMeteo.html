<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Langini Meteo ‚Äì Dashboard V5.2</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/raphael@2.3.0/raphael.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/justgage@1.5.0/justgage.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>

<style>
body{margin:0;font-family:"Poppins",sans-serif;color:white;text-align:center;overflow-x:hidden;
transition:background 2s;background:linear-gradient(to bottom,#001b3a 0%,#004a8d 40%,#0066b2 100%);}
header{background:rgba(0,0,30,0.7);color:#fff;padding:16px 0 4px;font-size:1.7em;font-weight:600;
box-shadow:0 2px 10px rgba(0,0,0,0.25);}
#logo{font-size:1.05em;font-weight:400;color:#a9c9ff;}
#statusBar{background:rgba(0,0,0,0.15);font-size:0.93em;color:#a9c9ff;padding:6px;}
#sky{position:relative;height:46vh;overflow:hidden;border-bottom:4px solid #048;}
#stars{position:absolute;inset:0;opacity:0;z-index:2;}
.star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;animation:twinkle 4s infinite;}
@keyframes twinkle{0%,100%{opacity:0.2}50%{opacity:1}}
#sun,#moon{position:absolute;top:53%;left:50%;width:110px;height:110px;border-radius:50%;
transform:translate(-50%,-50%);transition:left 1.5s,top 1.5s,opacity 2s;z-index:3;opacity:0;}
#sun{background:radial-gradient(circle,#fff600 20%,#ffcc00 70%,#ffaa00 100%);box-shadow:0 0 40px 10px #ffcc00;}
#moon{background:radial-gradient(circle at 31% 32%,#f0f0f0 40%,#bdbdbd 100%);box-shadow:0 0 25px 5px #ccc;}
.cloud{position:absolute;background:rgba(255,255,255,0.8);border-radius:50%;
box-shadow:-30px 10px 30px rgba(255,255,255,0.7),40px 15px 40px rgba(255,255,255,0.6),
70px 20px 60px rgba(255,255,255,0.5);animation:fluttuare 6s ease-in-out infinite alternate;z-index:1;}
@keyframes fluttuare{from{transform:translateY(0)}to{transform:translateY(8px)}}

#skyStatus{font-size:1.4em;font-weight:600;color:#fff;background:rgba(0,0,0,0.3);
padding:8px 18px;border-radius:16px;display:inline-block;margin-top:-25px;
box-shadow:0 0 12px rgba(0,0,0,0.5);transition:all 1s ease;}
#skyStatus.sunny{background:linear-gradient(to right,#ffcc00,#ff6600);color:#000;}
#skyStatus.cloudy{background:linear-gradient(to right,#9ecfff,#b3e5fc);color:#003366;}
#skyStatus.dark{background:linear-gradient(to right,#001b3a,#002850);color:#a9c9ff;}

#sunMoonTimes{font-size:1em;color:#000;background:rgba(255,255,255,0.6);display:inline-block;
padding:4px 10px;border-radius:12px;margin:10px auto;box-shadow:0 0 6px rgba(0,0,0,0.25);
font-weight:600;transition:all 1s ease;}

#gauges{display:flex;flex-wrap:wrap;justify-content:center;gap:22px;
padding:30px 0 40px;background:linear-gradient(to bottom,#002850,#00142c);border-top:3px solid #004b8d;}
.gaugeBox{background:linear-gradient(to bottom,#f8fbff,#e6edf5);border-radius:16px;width:240px;height:250px;
padding:10px;color:#003366;box-shadow:0 0 14px rgba(0,0,0,0.14);position:relative;}
.gaugeBox img{position:absolute;top:10px;right:10px;width:34px;opacity:0.84;}
.label{font-size:1.17em;font-weight:600;margin-top:7px;}
.mean{font-size:0.9em;color:#444;margin-top:4px;}
footer{font-size:0.93em;color:#a9c9ff;background:#001b3a;padding:10px;}
@media(max-width:768px){
#gauges{gap:14px;padding:20px 0;}
.gaugeBox{width:180px;height:200px;}
}
</style>
</head>

<body>
<header>üå§Ô∏è Langini Meteo ‚Äì Dashboard V5.2<br><span id="logo">by Langini D.</span></header>
<div id="statusBar">Caricamento dati...</div>

<div id="sky">
  <div id="stars"></div>
  <div id="sun"></div>
  <div id="moon"></div>
</div>

<div id="skyStatus">‚òÄÔ∏è Sereno</div>
<div id="sunMoonTimes">‚òÄÔ∏è Alba: --:-- ‚Ä¢ üåá Tramonto: --:--</div>

<div id="gauges">
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/barometer.png"><div id="g1" style="height:150px"></div><div class="label">Pressione (hPa)</div><div class="mean">Media oraria: <span id="m1">--</span></div></div>
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/temperature.png"><div id="g2" style="height:150px"></div><div class="label">Temperatura (¬∞C)</div><div class="mean">Media oraria: <span id="m2">--</span></div></div>
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/hygrometer.png"><div id="g3" style="height:150px"></div><div class="label">Umidit√† (%)</div><div class="mean">Media oraria: <span id="m3">--</span></div></div>
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/smelling.png"><div id="g4" style="height:150px"></div><div class="label">Qualit√† Aria (MQ135)</div><div class="mean">Media oraria: <span id="m4">--</span></div></div>
</div>

<footer>¬© 2025 Langini Meteo ‚Ä¢ Aggiornamento ogni 30 s</footer>

<script>
const LAT=45.77,LON=8.88,CHANNEL_ID=3149218;

const g1=new JustGage({id:"g1",value:0,min:950,max:1050,pointer:true});
const g2=new JustGage({id:"g2",value:0,min:-10,max:50,pointer:true});
const g3=new JustGage({id:"g3",value:0,min:0,max:100,pointer:true});
const g4=new JustGage({id:"g4",value:0,min:0,max:500,pointer:true});

function aggiornaCielo(){
 const now=new Date(),t=SunCalc.getTimes(now,LAT,LON);
 const alba=t.sunrise.getHours()*60+t.sunrise.getMinutes();
 const tram=t.sunset.getHours()*60+t.sunset.getMinutes();
 const info=document.getElementById("sunMoonTimes");
 info.innerHTML=`‚òÄÔ∏è Alba: ${String(t.sunrise.getHours()).padStart(2,"0")}:${String(t.sunrise.getMinutes()).padStart(2,"0")} ‚Ä¢ üåá Tramonto: ${String(t.sunset.getHours()).padStart(2,"0")}:${String(t.sunset.getMinutes()).padStart(2,"0")}`;
}
aggiornaCielo();

async function aggiorna(){
 try{
  const r=await fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?results=1`);
  const d=await r.json();if(!d.feeds.length)return;
  const f=d.feeds[0];
  const val=[+f.field1,+f.field2,+f.field3,+f.field4,+f.field5];
  g1.refresh(val[0]);g2.refresh(val[1]);g3.refresh(val[2]);g4.refresh(val[3]);
  document.getElementById("statusBar").textContent=`‚úÖ Aggiornato alle ${new Date().toLocaleTimeString("it-IT")}`;
  
  // --- Stato cielo dal TEMT6000 ---
  const luce=val[4];const banner=document.getElementById("skyStatus");
  if(luce>3000){banner.textContent="‚òÄÔ∏è Sereno";banner.className="sunny";}
  else if(luce>1500){banner.textContent="üå§Ô∏è Nuvoloso";banner.className="cloudy";}
  else if(luce>200){banner.textContent="‚òÅÔ∏è Coperto";banner.className="cloudy";}
  else{banner.textContent="üåô Notte";banner.className="dark";}
 }catch(e){document.getElementById("statusBar").textContent="‚ö†Ô∏è Errore connessione";}
}
aggiorna();setInterval(aggiorna,30000);
</script>
</body>
</html>
