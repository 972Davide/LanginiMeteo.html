<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Langini Meteo Online</title>

<!-- Librerie Chart.js e Luxon -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@3.4.0/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  color: white;
  text-align: center;
  transition: background 2s;
}
header {
  background: #9998a8;
  color: white;
  font-weight: bold;
  padding: 12px 0;
  font-size: 1.5em;
}
#contenitore {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: flex-start;
  gap: 20px;
  padding: 20px;
}
.chartBox {
  background: rgba(255,255,255,0.9);
  border-radius: 12px;
  padding: 15px;
  width: 320px;
  height: 260px;
  box-shadow: 0 0 15px rgba(0,0,0,0.3);
}
footer {
  margin-top: 20px;
  font-size: 0.9em;
  color: #a9c9ff;
}
@media (max-width: 768px) {
  #contenitore {
    flex-direction: column;
    align-items: center;
  }
  .chartBox {
    width: 90%;
  }
}
</style>
</head>

<body>
<header>üå§Ô∏è Langini Meteo Online</header>
<div id="contenitore">
  <div class="chartBox"><canvas id="chartPressione"></canvas></div>
  <div class="chartBox"><canvas id="chartTemperatura"></canvas></div>
  <div class="chartBox"><canvas id="chartUmidita"></canvas></div>
  <div class="chartBox"><canvas id="chartAria"></canvas></div>
</div>

<footer>
  Aggiornamento automatico ogni 30 s<br>
  ¬© 2025 Langini Meteo ‚Ä¢ ThingSpeak API live
</footer>

<script>
const CHANNEL_ID = 3149218;  // tuo ID canale
const API_KEY = "4EGG4DXUFDU6FUGN"; // chiave lettura
const VENEGONO_LAT = 45.77;
const VENEGONO_LON = 8.88;

const grafici = {
  chartPressione: { field: 1, label: "Pressione (hPa)", color: "#3498db" },
  chartTemperatura: { field: 2, label: "Temperatura (¬∞C)", color: "#e67e22" },
  chartUmidita: { field: 3, label: "Umidit√† (%)", color: "#2ecc71" },
  chartAria: { field: 4, label: "Qualit√† Aria (MQ135)", color: "#9b59b6" }
};

function aggiornaSfondo() {
  const now = new Date();
  const h = now.getHours();
  const giorno = h >= 7 && h < 18;
  document.body.style.background = giorno ?
    "linear-gradient(#7ec9ff, #0055aa)" :
    "linear-gradient(#000033, #004477)";
}

function creaGrafico(id, etichetta, colore) {
  const ctx = document.getElementById(id).getContext("2d");
  return new Chart(ctx, {
    type: "line",
    data: { datasets: [{ label: etichetta, data: [], borderColor: colore, fill: false, tension: 0.2 }] },
    options: {
      scales: {
        x: { type: "time", time: { unit: "minute" }, ticks: { color: "#333" } },
        y: { ticks: { color: "#333" } }
      },
      plugins: {
        legend: { display: true, labels: { color: "#333" } }
      },
      responsive: true,
      maintainAspectRatio: false
    }
  });
}

const charts = {};
for (const id in grafici) {
  const cfg = grafici[id];
  charts[id] = creaGrafico(id, cfg.label, cfg.color);
}

async function aggiornaDati() {
  aggiornaSfondo();
  for (const id in grafici) {
    const cfg = grafici[id];
    const url = `https://api.thingspeak.com/channels/${CHANNEL_ID}/fields/${cfg.field}.json?api_key=${API_KEY}&results=30`;
    const res = await fetch(url);
    const data = await res.json();
    const valori = data.feeds.map(e => ({
      x: new Date(e.created_at),
      y: parseFloat(e[`field${cfg.field}`])
    }));
    charts[id].data.datasets[0].data = valori;
    charts[id].update();
  }
}

aggiornaDati();
setInterval(aggiornaDati, 30000);
</script>
</body>
</html>
